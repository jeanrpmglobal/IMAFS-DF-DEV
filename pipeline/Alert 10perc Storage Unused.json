{
	"name": "Alert 10perc Storage Unused",
	"properties": {
		"activities": [
			{
				"name": "Perc_Unused_Perc_Space",
				"type": "Lookup",
				"dependsOn": [],
				"policy": {
					"timeout": "0.12:00:00",
					"retry": 0,
					"retryIntervalInSeconds": 30,
					"secureOutput": false,
					"secureInput": false
				},
				"userProperties": [
					{
						"name": "PercFree",
						"value": "@activity('Perc_Dev_Preprod').output.firstRow.name"
					}
				],
				"typeProperties": {
					"source": {
						"type": "AzureSqlSource",
						"sqlReaderQuery": "SELECT TOP 1\n    DB_NAME() AS DatabaseName,\n    ROUND(SUM(size * 8 / 1024),0) AS TotalSizeMB,\n    ROUND(SUM(CAST(FILEPROPERTY(name, 'SpaceUsed') AS float) * 8 / 1024),0) AS UsedSpaceMB,\n    ROUND(SUM(size * 8 / 1024) - SUM(CAST(FILEPROPERTY(name, 'SpaceUsed') AS float) * 8 / 1024),0) AS UnusedSpaceMB,\n    ROUND((SUM(size * 8 / 1024) - SUM(CAST(FILEPROPERTY(name, 'SpaceUsed') AS float) * 8 / 1024)) / SUM(size * 8 / 1024) * 100,0) AS UnusedPercent\nFROM\n    sys.database_files\nGROUP BY\n    type_desc\nORDER BY\n    TotalSizeMB DESC;",
						"queryTimeout": "02:00:00",
						"partitionOption": "None"
					},
					"dataset": {
						"referenceName": "StoredProc_PROD_VEGPRO2",
						"type": "DatasetReference"
					}
				}
			}
		],
		"variables": {
			"firstRow": {
				"type": "String"
			}
		},
		"folder": {
			"name": "DBA Jobs"
		},
		"annotations": [],
		"lastPublishTime": "2023-06-05T21:05:38Z"
	},
	"type": "Microsoft.DataFactory/factories/pipelines"
}